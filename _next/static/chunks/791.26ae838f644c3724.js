"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[791],{6791:(t,i,e)=>{e.r(i),e.d(i,{default:()=>p});var s=e(8081),a=e(2149),o=e(5160),r=e(5192),l=e(7687);let n=a.forwardRef((t,i)=>{let{className:e,...a}=t;return(0,s.jsxs)(r.bL,{ref:i,className:(0,l.cn)("relative flex w-full touch-none select-none items-center",e),...a,children:[(0,s.jsx)(r.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,s.jsx)(r.Q6,{className:"absolute h-full bg-primary"})}),(0,s.jsx)(r.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});n.displayName=r.bL.displayName;var h=e(392),c=e(6801),d=e(6360),m=e(1528),u=e(2486);class g{configureMotor(t){let i=t.motorType||"NEO",e=t.gearing||1,s=t.motorCount||1,a={NEO:{kv:473,kt:.025,R:.116/s,m:.425*s},NEO550:{kv:774,kt:.015,R:.08/s,m:.235*s},Falcon500:{kv:577,kt:.019,R:.115/s,m:.31*s},KrakenX60:{kv:590,kt:.021,R:.1/s,m:.39*s},KrakenX40:{kv:590,kt:.014,R:.15/s,m:.26*s}},o=a[i]||a.NEO;this.motor={kv:o.kv/e,kt:o.kt*e,R:o.R,m:o.m,gearing:e}}reset(){this.position=0,this.velocity=0,this.acceleration=0,this.voltage=0,this.current=0,this.integral=0,this.prevError=0,this.time=0}setTarget(t){this.target=t}setTargetVelocity(t){this.targetVelocity=t}setControlMode(t){this.controlMode=t}calculateFeedforward(t,i){let e=this.kG||0,s=this.kS*Math.sign(t);return s+this.kV*t+this.kA*i+e}calculatePID(t){this.integral+=t*this.dt;let i=(t-this.prevError)/this.dt;return this.prevError=t,this.kP*t+this.kI*this.integral+this.kD*i}update(t){this.dt=t||this.dt,this.time+=this.dt;let i=0;if("position"===this.controlMode){let t=this.target-this.position;i=this.calculatePID(t)}else if("velocity"===this.controlMode){let t=this.targetVelocity-this.velocity;i=this.calculatePID(t)}let e=this.calculateFeedforward(this.velocity,this.acceleration);this.voltage=i+e,this.voltage=Math.max(-12,Math.min(12,this.voltage)),this.updatePhysics(),Math.round(50*this.time)%50==0&&console.debug("Base sim update:",{controlMode:this.controlMode,target:this.target,targetVelocity:this.targetVelocity,position:this.position,velocity:this.velocity,voltage:this.voltage,controlOutput:i,ffOutput:e})}updatePhysics(){}draw(){this.ctx.clearRect(0,0,this.width,this.height)}constructor(t,i={}){this.canvas=t,this.ctx=t.getContext("2d"),this.width=t.width,this.height=t.height,this.time=0,this.dt=i.dt||.02,this.target=0,this.targetVelocity=0,this.controlMode="position",this.kP=i.kP||1,this.kI=i.kI||0,this.kD=i.kD||0,this.kS=i.kS||0,this.kV=i.kV||0,this.kA=i.kA||0,this.kG=i.kG||0,this.position=0,this.velocity=0,this.acceleration=0,this.voltage=0,this.current=0,this.integral=0,this.prevError=0,this.configureMotor(i)}}class v extends g{updatePhysics(){let t=this.velocity*(1/this.motor.kv)*(2*Math.PI/60);this.current=(this.voltage-t)/this.motor.R;let i=this.current*this.motor.kt,e=9.81*this.mass*(this.length/2)*Math.sin(this.position);this.acceleration=(i-e)/this.moi,this.velocity+=this.acceleration*this.dt,this.position+=this.velocity*this.dt,this.position<this.minAngle&&(this.position=this.minAngle,this.velocity=Math.max(0,this.velocity)),this.position>this.maxAngle&&(this.position=this.maxAngle,this.velocity=Math.min(0,this.velocity)),Math.round(50*this.time)%50==0&&console.debug("Arm sim update:",{position:this.position,velocity:this.velocity,acceleration:this.acceleration,voltage:this.voltage,current:this.current,target:this.target})}draw(){let t=this.ctx,i=this.width,e=this.height;t.clearRect(0,0,i,e);let s=i/2,a=.8*e,o=.4*Math.min(i,e),r=this.length*o,l=s+r*Math.sin(this.position),n=a-r*Math.cos(this.position);t.fillStyle="#333",t.beginPath(),t.rect(s-20,a-10,40,20),t.fill(),t.strokeStyle="#0066cc",t.lineWidth=10,t.beginPath(),t.moveTo(s,a-10),t.lineTo(l,n),t.stroke(),t.fillStyle="#666",t.beginPath(),t.arc(s,a-10,8,0,2*Math.PI),t.fill(),t.fillStyle="#cc0000",t.beginPath(),t.arc(l,n,12,0,2*Math.PI),t.fill(),this.drawAngleMarkers(t,s,a-10),this.drawTelemetry(t)}drawAngleMarkers(t,i,e){t.strokeStyle="rgba(100, 100, 100, 0.5)",t.lineWidth=2,t.beginPath(),t.arc(i,e,40,-this.maxAngle,-this.minAngle),t.stroke(),t.strokeStyle="#00cc00",t.lineWidth=3,t.beginPath(),t.moveTo(i,e),t.lineTo(i+40*Math.sin(this.position),e-40*Math.cos(this.position)),t.stroke(),t.strokeStyle="#ff6600",t.lineWidth=2,t.beginPath(),t.moveTo(i,e),t.lineTo(i+40*Math.sin(this.target),e-40*Math.cos(this.target)),t.stroke()}drawTelemetry(t){t.font="14px Arial",t.fillStyle="#fff",t.textAlign="left";let i=20;t.fillText("Angle: ".concat((180*this.position/Math.PI).toFixed(1),"\xb0"),10,i),i+=20,t.fillText("Target: ".concat((180*this.target/Math.PI).toFixed(1),"\xb0"),10,i),i+=20,t.fillText("Velocity: ".concat((180*this.velocity/Math.PI).toFixed(1),"\xb0/s"),10,i),i+=20,t.fillText("Voltage: ".concat(this.voltage.toFixed(2)," V"),10,i),i+=20,t.fillText("Current: ".concat(this.current.toFixed(2)," A"),10,i)}constructor(t,i={}){super(t,i),this.length=i.length||1,this.mass=i.mass||5,this.moi=i.moi||this.mass*this.length*this.length/3,this.minAngle=void 0!==i.minAngle?i.minAngle:-Math.PI/2,this.maxAngle=void 0!==i.maxAngle?i.maxAngle:Math.PI/2,this.startingAngle=void 0!==i.startingAngle?i.startingAngle:0,this.position=this.startingAngle,this.kG=void 0!==i.kG?i.kG:9.81*this.mass*this.length/2/(this.motor.kt/this.motor.R)}}class f extends g{updatePhysics(){this.position,this.drumRadius;let t=this.velocity/this.drumRadius*(1/this.motor.kv)*(2*Math.PI/60);this.current=(this.voltage-t)/this.motor.R;let i=this.current*this.motor.kt,e=9.81*this.mass*this.drumRadius,s=this.mass*this.drumRadius*this.drumRadius;this.acceleration=(i-e)/s*this.drumRadius,this.velocity+=this.acceleration*this.dt,this.position+=this.velocity*this.dt,this.position<this.minHeight&&(this.position=this.minHeight,this.velocity=Math.max(0,this.velocity)),this.position>this.maxHeight&&(this.position=this.maxHeight,this.velocity=Math.min(0,this.velocity)),Math.round(50*this.time)%50==0&&console.debug("Elevator sim update:",{position:this.position,velocity:this.velocity,acceleration:this.acceleration,voltage:this.voltage,current:this.current,target:this.target})}draw(){let t=this.ctx,i=this.width,e=this.height;t.clearRect(0,0,i,e);let s=.2*i,a=.7*e,o=.1*e,r=.3*i,l=this.maxHeight-this.minHeight,n=(this.position-this.minHeight)/l;t.fillStyle="#333",t.beginPath(),t.rect(r,e-o-a-80,s,a+80),t.fill(),t.fillStyle="#0066cc",t.beginPath(),t.rect(r-10,e-o-80-n*a,s+20,80),t.fill(),t.fillStyle="#555",t.beginPath(),t.rect(r-20,e-o,s+40,o),t.fill(),this.drawHeightMarkers(t,r,e-o,a),this.drawTelemetry(t)}drawHeightMarkers(t,i,e,s){let a=s/10;t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=1;for(let s=0;s<=10;s++){let o=e-s*a;if(t.beginPath(),t.moveTo(i-10,o),t.lineTo(i-5,o),t.stroke(),s%2==0){let e=this.minHeight+s/10*(this.maxHeight-this.minHeight);t.fillStyle="#fff",t.font="12px Arial",t.textAlign="right",t.fillText("".concat(e.toFixed(2),"m"),i-15,o+4)}}let o=e-(this.position-this.minHeight)/(this.maxHeight-this.minHeight)*s;t.strokeStyle="#00cc00",t.lineWidth=2,t.beginPath(),t.moveTo(i-15,o),t.lineTo(i-5,o),t.stroke();let r=e-(this.target-this.minHeight)/(this.maxHeight-this.minHeight)*s;t.strokeStyle="#ff6600",t.lineWidth=2,t.beginPath(),t.moveTo(i-15,r),t.lineTo(i-5,r),t.stroke()}drawTelemetry(t){t.font="14px Arial",t.fillStyle="#fff",t.textAlign="left";let i=20;t.fillText("Height: ".concat(this.position.toFixed(3),"m"),10,i),i+=20,t.fillText("Target: ".concat(this.target.toFixed(3),"m"),10,i),i+=20,t.fillText("Velocity: ".concat(this.velocity.toFixed(3),"m/s"),10,i),i+=20,t.fillText("Voltage: ".concat(this.voltage.toFixed(2),"V"),10,i),i+=20,t.fillText("Current: ".concat(this.current.toFixed(2),"A"),10,i)}constructor(t,i={}){super(t,i),this.mass=i.mass||5,this.drumRadius=i.drumRadius||.0254,this.minHeight=void 0!==i.minHeight?i.minHeight:0,this.maxHeight=void 0!==i.maxHeight?i.maxHeight:1,this.startingHeight=void 0!==i.startingHeight?i.startingHeight:this.minHeight,this.position=this.startingHeight,this.kG=void 0!==i.kG?i.kG:9.81*this.mass*this.drumRadius/(this.motor.kt/this.motor.R)}}function p(t){let{formValues:i,simType:e}=t,r=(0,a.useRef)(null),[l,g]=(0,a.useState)(!1),[p,k]=(0,a.useState)(null),x=(0,a.useRef)(null),[y,P]=(0,a.useState)(0),[M,A]=(0,a.useState)(null);(0,a.useLayoutEffect)(()=>((function(){let t=console.error;console.error=function(){for(var i,e,s=arguments.length,a=Array(s),o=0;o<s;o++)a[o]=arguments[o];!((null===(e=a[0])||void 0===e?void 0:null===(i=e.includes)||void 0===i?void 0:i.call(e,"ResizeObserver loop"))||"string"==typeof a[0]&&a[0].includes("ResizeObserver loop"))&&t.apply(console,a)}})(),()=>{console.error=console.error}),[]),(0,a.useEffect)(()=>{if(r.current)try{var t,s,a,o,l,n,h,c,d,m,u,g,p,x,y,M,w,b,H,R,V,I,S;let j=null,N=r.current;switch(i.mechanismType){case"Arm":j=new v(N,{length:(null===(t=i.armParams)||void 0===t?void 0:t.length)||1,mass:(null===(s=i.armParams)||void 0===s?void 0:s.mass)||5,motorCount:1,gearing:i.gearRatio,motorType:T(i.motorType),minAngle:(null===(a=i.armParams)||void 0===a?void 0:a.hardLimitMin)!==void 0?Math.PI*i.armParams.hardLimitMin/180:-Math.PI/2,maxAngle:(null===(o=i.armParams)||void 0===o?void 0:o.hardLimitMax)!==void 0?Math.PI*i.armParams.hardLimitMax/180:Math.PI/2,startingAngle:(null===(l=i.armParams)||void 0===l?void 0:l.startingPosition)!==void 0?Math.PI*i.armParams.startingPosition/180:0,kP:i.pidValues.kP,kI:i.pidValues.kI,kD:i.pidValues.kD,kS:(null===(n=i.feedforward)||void 0===n?void 0:n.kS)||0,kV:(null===(h=i.feedforward)||void 0===h?void 0:h.kV)||0,kA:(null===(c=i.feedforward)||void 0===c?void 0:c.kA)||0,kG:(null===(d=i.feedforward)||void 0===d?void 0:d.kG)||0}),P((null===(m=i.armParams)||void 0===m?void 0:m.startingPosition)||0);break;case"Elevator":j=new f(N,{mass:(null===(u=i.elevatorParams)||void 0===u?void 0:u.mass)||5,drumRadius:(null===(g=i.elevatorParams)||void 0===g?void 0:g.drumRadius)||.0254,motorCount:1,gearing:i.gearRatio,motorType:T(i.motorType),minHeight:(null===(p=i.elevatorParams)||void 0===p?void 0:p.hardLimitMin)||0,maxHeight:(null===(x=i.elevatorParams)||void 0===x?void 0:x.hardLimitMax)||1,startingHeight:(null===(y=i.elevatorParams)||void 0===y?void 0:y.startingHeight)||0,kP:i.pidValues.kP,kI:i.pidValues.kI,kD:i.pidValues.kD,kS:(null===(M=i.feedforward)||void 0===M?void 0:M.kS)||0,kV:(null===(w=i.feedforward)||void 0===w?void 0:w.kV)||0,kA:(null===(b=i.feedforward)||void 0===b?void 0:b.kA)||0,kG:(null===(H=i.feedforward)||void 0===H?void 0:H.kG)||0}),P((null===(R=i.elevatorParams)||void 0===R?void 0:R.startingHeight)||0);break;case"Pivot":j=new v(N,{length:.3,mass:2,motorCount:1,gearing:i.gearRatio,motorType:T(i.motorType),minAngle:-Math.PI/2,maxAngle:Math.PI/2,startingAngle:0,kP:i.pidValues.kP,kI:i.pidValues.kI,kD:i.pidValues.kD,kS:(null===(V=i.feedforward)||void 0===V?void 0:V.kS)||0,kV:(null===(I=i.feedforward)||void 0===I?void 0:I.kV)||0,kA:(null===(S=i.feedforward)||void 0===S?void 0:S.kA)||0,kG:0}),P(0)}j&&(j.setControlMode(e),j.draw(),k(j),A(null))}catch(t){console.error("Error initializing simulation:",t),A("Failed to initialize simulation: ".concat(t instanceof Error?t.message:String(t)))}},[i,e]),(0,a.useEffect)(()=>{if(!p)return;let t=()=>{p.update(.02),p.draw(),l&&(x.current=requestAnimationFrame(t))};return l?(console.log("Starting animation loop"),x.current=requestAnimationFrame(t)):x.current&&(console.log("Stopping animation loop"),cancelAnimationFrame(x.current),x.current=null),()=>{x.current&&(cancelAnimationFrame(x.current),x.current=null)}},[l,p]),(0,a.useEffect)(()=>{p&&p.setControlMode(e)},[e,p]);let T=t=>{switch(t){case"NEO":default:return"NEO";case"NEO550":return"NEO550";case"Krakenx60":return"KrakenX60";case"Krakenx40":return"KrakenX40";case"Minion":return"Falcon500"}},w=t=>{if(!p)return;let s=t[0];P(s);try{"position"===e?"Arm"===i.mechanismType||"Pivot"===i.mechanismType?p.setTarget(s*Math.PI/180):p.setTarget(s):"Arm"===i.mechanismType||"Pivot"===i.mechanismType?p.setTargetVelocity(s*Math.PI/180):p.setTargetVelocity(s),l||p.draw()}catch(t){console.error("Error setting target:",t)}},b=(()=>{if("position"===e){var t,s,a,o;switch(i.mechanismType){case"Arm":return{min:(null===(t=i.armParams)||void 0===t?void 0:t.hardLimitMin)!==void 0?i.armParams.hardLimitMin:-90,max:(null===(s=i.armParams)||void 0===s?void 0:s.hardLimitMax)!==void 0?i.armParams.hardLimitMax:90,step:1,unit:"\xb0"};case"Elevator":return{min:(null===(a=i.elevatorParams)||void 0===a?void 0:a.hardLimitMin)!==void 0?i.elevatorParams.hardLimitMin:0,max:(null===(o=i.elevatorParams)||void 0===o?void 0:o.hardLimitMax)!==void 0?i.elevatorParams.hardLimitMax:1,step:.01,unit:"m"};case"Pivot":return{min:-90,max:90,step:1,unit:"\xb0"};default:return{min:-1,max:1,step:.1,unit:""}}}else switch(i.mechanismType){case"Arm":case"Pivot":return{min:-90,max:90,step:1,unit:"\xb0/s"};case"Elevator":return{min:-1,max:1,step:.01,unit:"m/s"};default:return{min:-1,max:1,step:.1,unit:""}}})();return M?(0,s.jsxs)("div",{className:"p-4 bg-red-100 text-red-800 rounded-md",children:[(0,s.jsx)("p",{className:"font-semibold",children:"Error:"}),(0,s.jsx)("p",{children:M})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("canvas",{ref:r,width:600,height:400,className:"border border-gray-300 rounded-md bg-slate-800 w-full max-w-[600px] h-auto"})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 py-2",children:[(0,s.jsx)(o.$,{variant:"outline",size:"icon",onClick:()=>w([Math.max(b.min,y-b.step)]),children:(0,s.jsx)(h.A,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(n,{value:[y],min:b.min,max:b.max,step:b.step,onValueChange:w})}),(0,s.jsx)(o.$,{variant:"outline",size:"icon",onClick:()=>w([Math.min(b.max,y+b.step)]),children:(0,s.jsx)(c.A,{className:"h-4 w-4"})}),(0,s.jsxs)("div",{className:"w-20 text-center",children:[y.toFixed(2),b.unit]})]}),(0,s.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,s.jsxs)(o.$,{onClick:()=>{!l&&p&&("position"===e?"Arm"===i.mechanismType||"Pivot"===i.mechanismType?p.setTarget(y*Math.PI/180):p.setTarget(y):"Arm"===i.mechanismType||"Pivot"===i.mechanismType?p.setTargetVelocity(y*Math.PI/180):p.setTargetVelocity(y),p.update(.02),p.draw(),console.log("Starting simulation with target:",y)),g(t=>!t)},children:[l?(0,s.jsx)(d.A,{className:"mr-2 h-4 w-4"}):(0,s.jsx)(m.A,{className:"mr-2 h-4 w-4"}),l?"Pause":"Run"]}),(0,s.jsxs)(o.$,{onClick:()=>{if(p){var t,e;p.reset(),p.draw(),"Arm"===i.mechanismType?P((null===(t=i.armParams)||void 0===t?void 0:t.startingPosition)||0):"Elevator"===i.mechanismType?P((null===(e=i.elevatorParams)||void 0===e?void 0:e.startingHeight)||0):P(0)}},variant:"outline",children:[(0,s.jsx)(u.A,{className:"mr-2 h-4 w-4"}),"Reset"]})]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground mt-4",children:[(0,s.jsx)("p",{children:"This simulation uses the WPILib controls simulation library to visualize mechanism behavior."}),(0,s.jsx)("p",{children:"The simulation parameters are derived from your form inputs."}),(0,s.jsxs)("p",{children:["Use the slider to adjust the target ","position"===e?"position":"velocity","."]})]})]})}}}]);